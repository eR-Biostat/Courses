---
output:
  bookdown::html_document2:
    toc: TRUE
    toc_float: TRUE
    toc_depth: 2
    number_sections: no
    css: ./lib/stylesArial.css
    code_folding: hide

params: 
  department: ">eR-BioStat" 
  topic: <font size = "10" > **Foundations for inference using R - the NHANES case study**</font>
  author: "Ziv Shkedy and Thi Huyen Nguyen based on **Chapter 4** in the  book of Julie Vu and Dave Harrington *Introductory Statistics for the
Life and Biomedical Sciences* (https://www.openintro.org/book/biostat/)"
  date: "26-03-2025"
  endCode: FALSE
  RmdLocation: ""
---


<p>
  <img id="image" src="banner.jpg">
</p>



```{r delaycodeprinting, message=FALSE, warning=FALSE, echo = FALSE}
# You can delete this chunk if you do not want delaycodeprinting and adjust the YAML header accordingly
library(knitr)
# The **delaycodeprinting** chunk below allows all R code to be printed at the end of the report (endCode = TRUE) 
#    or prints the RMDLocation from the YAML header as a code reference (endCode != TRUE)
#    see code chunk named 'codeprint'
delay_code_labels <- NULL
knit_hooks$set(delay = function(before, options, envir) {
    if (before) {
        delay_code_labels <<- append(delay_code_labels, options$label)
        return(NULL)  ## otherwise knitr will print delay_code_labels every time
    } else {}
})

if(params$endCode == TRUE){
  opts_chunk$set(delay = TRUE, #Do not change delay = TRUE
                 #You may change global options below
                 echo = FALSE, message = FALSE, warning = FALSE)
} else {
  #You may change global options below
  opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
}
#Read more about R code chunk options: https://yihui.name/knitr/options/#chunk_options
```

<!--- R system setup --->
```{r setup, message=FALSE, warning=FALSE}

## SETUP Folder Location if needed

#setwd("...")

## SETUP themes or other necessary settings like color palette etc.

# theme_set(theme_bw())
# pal = "Set1"
# scale_colour_discrete <- function(palname = pal, ...) {
#   scale_colour_brewer(palette = palname, ...)
# }
# scale_fill_discrete <- function(palname = pal, ...) {
#   scale_fill_brewer(palette = palname, ...)
# }

```


<!-------------------------- DO NOT MODIFY TEXT BELOW -------------------------------------> 
<!------------- Any parameter modification should be down in the YAML header --------------> 
<!------------- You can add or delete  to fix title page spacing     --------------> 

<!-------------------------- DO NOT MODIFY TEXT BELOW -------------------------------------> 
<!------------- The following ~30 lines are the first page of the report ------------------> 
<!------------- Any parameter modification should be down in the YAML header --------------> 

<br> 
<br> 

<p id="head2"> `r params$company` </p>

<p id="head3"> &nbsp; `r params$date` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `r params$department` </p>

***

<p id="head2"> `r params$training` </p>

<p id="head2"> `r params$topic` </p>

<p id="head2"> `r params$author` </p>



<!------------- DO NOT MODIFY TEXT ABOVE THIS COMMENT ------------------> 

<!------------- Enter text and code below -------------------> 

```{r init, echo=TRUE, message=FALSE, warning=FALSE}

## load/install libraries
.libPaths(c("./Rpackages",.libPaths()))
library(knitr)
library(tidyverse)
library(deSolve)
library(minpack.lm)
library(ggpubr)
library(readxl)
library(gamlss)
library(data.table)
library(grid)
library(png)
library(nlme)
library(gridExtra)
library(mvtnorm)
library(e1071)
library(lattice)
library(ggplot2)
library(dslabs)
library(NHANES)
library(plyr)
library(dplyr)
library(nasaweather)
library(ggplot2)
library(gganimate)
library(av)
library(gifski)
library(foreach)
library("DAAG")
library(DT)
library(TeachingDemos)
library(gridExtra)
```



#  Example: the NHANES data set analysis of the number of sleep hours per night

## The population 

In this section, the variable of interest is the number of sleeping hours per night (the variable <tt>SleepHrsNight</tt>). Information about the number of sleeping hours per night is available for 7755 individuals (i.e., the population). The population mean and variance are $\mu=6.927$ and $\sigma^{2}=1.813$, respectively.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(NHANES)
data(NHANES)
#dim(NHANES)
sleep<-na.omit(NHANES$SleepHrsNight)
length(sleep)
mean(sleep)
var(sleep)
```


## Visualization

Figure 19, 20 and 21 show the histogram, dotplot and boxplot of the number of sleeping hours in the population and reveal a discrete distribution as expected. Note that the number of sleeping hours per night is a count variable.

```{r, echo=TRUE, message=FALSE, warning=FALSE,fig.cap="Histogram of sleep hours per night."}
ggplot(NHANES, aes(x = SleepHrsNight)) +
  geom_histogram(fill = "skyblue", color = "black")+
  ylab("Frequency")+
  xlab("Sleep hours per night")
```



```{r, echo=TRUE, message=FALSE, warning=FALSE,fig.cap="Dot plot of sleep hours per night."}
 ggplot(NHANES, aes(x = c(1:length(NHANES$SleepHrsNight)), y = SleepHrsNight)) +
   geom_point(position = position_jitter(height = 0.05), color = "blue") +
   xlab("Subject")+
   ylab("Sleep hours per night")
```

```{r, echo=TRUE, message=FALSE, warning=FALSE,fig.cap="Boxplot of sleep hours per night."}
ggplot(NHANES, aes(x = "", y = SleepHrsNight)) +
  geom_boxplot(fill = "skyblue", color = "black")+
  geom_jitter(aes(x = "", y = SleepHrsNight), color = "black", size = 0.1, alpha = 0.5)+
  ylab("Sleep hours per night")+
  xlab("")
```

## A random sample of size 150 from the population

We draw a sample of 150 indivuduals from the population ($n=150$). The point estimates from the sample are $\bar{x}=6.8466$ and $\sigma^{2}=1.8622$.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
set.seed(456789)
x.sleep<-sample(na.omit(NHANES$SleepHrsNight),size=150,replace=FALSE)
length(x.sleep)
mean(x.sleep)
var(x.sleep)
```
### Visualization

Figure 22 shows the histogram (left panel) and boxplot (right panel) of the sample.

```{r, echo=TRUE, message=FALSE, warning=FALSE,fig.cap="Histogram of sleep hours per night in the sample."}
hist_sleep = ggplot(data.frame(SleepHrsNight = x.sleep), aes(x = SleepHrsNight)) +
  geom_histogram(fill = "skyblue", color = "black")+
  ylab("Frequency")+
  xlab("Sleep hours per night")+
  ggtitle("Histogram")
```



```{r, echo=TRUE, message=FALSE, warning=FALSE,fig.cap="Box plot of sleep hours per night in the sample."}
box_sleep = ggplot(data.frame(SleepHrsNight = x.sleep), aes(x = "", y = SleepHrsNight)) +
  geom_boxplot(fill = "lightblue")+
  xlab("")+
  ylab("Sleep hours per night")+
  ggtitle("Box plot")
```

```{r, echo=TRUE, message=FALSE, warning=FALSE, fig.cap="Histogram and box plot of sleep hours per night in the sample."}
grid.arrange(hist_sleep, box_sleep, ncol = 2)
```


### A $95\%$ C.I for the mean sleep hours per night

The sample standard deveation and the standard error of the sample mean are equal to 1.3646 and 0.1114, respectivly.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
n<-length(x.sleep)
SD.x<-sqrt(var(x.sleep))
SD.x
SE<-SD.x/sqrt(n)
SE
```

For the sample, the error margin for a $95\%$ confidence interval is $m=1.96 \times SE=1.96 \times 0.1114$ and the confidence interval is given by $$\bar{x} \pm m=6.8466 \pm 0.2183 = (6.628279,7.065054). $$

```{r, echo=TRUE, message=FALSE, warning=FALSE}
LL<-mean(x.sleep)-1.96*SE
UL<-mean(x.sleep)+1.96*SE
c(LL,UL)
```

### Visualization

Figure 23 shows a histogram of the BMI with a $95\%$ confidence interval for the population mean.

```{r, echo=TRUE, message=FALSE, warning=FALSE,fig.cap="Histogram with a confidence interval for the population mean."}
hist_sleep = ggplot(data.frame(SleepHrsNight = x.sleep), aes(x = SleepHrsNight)) +
  geom_histogram(fill = "skyblue", color = "black")+
  geom_vline(xintercept = LL, color = "red", linetype = "dashed")+
  geom_vline(xintercept = UL, color = "red", linetype = "dashed")+
  geom_text(aes(x = LL-0.25, y = 42.5, label = "LL"), color = "red")+
  geom_text(aes(x = UL+0.25, y = 42.5, label = "UL"), color = "red")+
  ylab("Frequency")+
  xlab("Sleep hours per night")+
  ggtitle("Histogram and C.I")
hist_sleep
```

### Hypothesis testing

We wish to test the null hypothesis $\mu=7$ aginst a one sided alternative $H_{1}:\mu <7$. This can be done using the argument <tt>alternative = 'less'</tt> in the function <tt>z.test</tt>. Note that we assume that in the population, $\sigma=1.3646$. As can be seen in the panel below, for the sample, the mean number of sleeping hours is equal to $\bar{x}=6.8466$ and the test statistic is equal to $-1.3761$. The $p$-\mbox{value}=0.08439 > 0.05$. We cannot reject the null hypothesis and conclude that $\mu=7$.

```{r, echo=TRUE, message=FALSE, warning=FALSE}
mean(x.sleep)
sqrt(var(x.sleep))
z.test(x.sleep,mu=7, 1.364638, alternative = 'less')
```
